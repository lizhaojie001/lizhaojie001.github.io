
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>CoreText 入门 | 严青的博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="严青">
    

    
    <meta name="description" content="CoreText认识 Core Text is an advanced, low-level technology for laying out text and handling fonts. The Core Text API, introduced in Mac OS X v10.5 and iOS 3.2, is accessible from all OS X and iOS envir">
<meta name="keywords" content="CoreText,翻译">
<meta property="og:type" content="article">
<meta property="og:title" content="CoreText 入门">
<meta property="og:url" content="https://lizhaojie001.github.io/2016/10/09/CoreText-入门/index.html">
<meta property="og:site_name" content="严青的博客">
<meta property="og:description" content="CoreText认识 Core Text is an advanced, low-level technology for laying out text and handling fonts. The Core Text API, introduced in Mac OS X v10.5 and iOS 3.2, is accessible from all OS X and iOS envir">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://xiangwangfeng.com/images/ct6.jpg">
<meta property="og:image" content="http://tangqiao.b0.upaiyun.com/coretext/coretext_arch.png">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/65cc0af7gw1e2u5ypr899g.gif">
<meta property="og:image" content="http://ww3.sinaimg.cn/large/65cc0af7jw1e2ucdlrkfbg.gif">
<meta property="og:image" content="http://ww2.sinaimg.cn/large/65cc0af7gw1e2u242uytyg.gif">
<meta property="og:image" content="http://7xux50.com2.z0.glb.clouddn.com/2016122114822846996545.jpg?imageView2/0/format/jpg">
<meta property="og:image" content="http://ww4.sinaimg.cn/large/65cc0af7gw1e2uwkpr6rfj.jpg">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/65cc0af7gw1e2uwlh7zvej.jpg">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/65cc0af7gw1e2uxd1gmhwj.jpg">
<meta property="og:image" content="http://ww4.sinaimg.cn/large/65cc0af7gw1e2uyn6r88oj.jpg">
<meta property="og:image" content="http://7xux50.com2.z0.glb.clouddn.com/20161219148214987090595.jpg?imageView2/0/format/jpg">
<meta property="og:image" content="http://7xux50.com2.z0.glb.clouddn.com/20161219148215001527630.jpg?imageView2/0/format/jpg">
<meta property="og:image" content="http://7xux50.com2.z0.glb.clouddn.com/2016121914821501244382.jpg?imageView2/0/format/jpg">
<meta property="og:image" content="http://7xux50.com2.z0.glb.clouddn.com/20161219148215025125706.jpg?imageView2/0/format/jpg">
<meta property="og:image" content="http://7xux50.com2.z0.glb.clouddn.com/20161219148215032912970.jpg?imageView2/0/format/jpg">
<meta property="og:image" content="http://7xux50.com2.z0.glb.clouddn.com/20161219148215040140848.jpg?imageView2/0/format/jpg">
<meta property="og:image" content="http://7xux50.com2.z0.glb.clouddn.com/20161219148215067551448.jpg?imageView2/0/format/jpg">
<meta property="og:image" content="http://7xux50.com2.z0.glb.clouddn.com/20161219148215075086710.jpg?imageView2/0/format/jpg">
<meta property="og:image" content="http://7xux50.com2.z0.glb.clouddn.com/2016121914821521365588.jpg?imageView2/0/format/jpg">
<meta property="og:image" content="http://7xux50.com2.z0.glb.clouddn.com/2016121914821513271334.jpg?imageView2/0/format/jpg">
<meta property="og:image" content="http://7xux50.com2.z0.glb.clouddn.com/20161219148215145682042.jpg?imageView2/0/format/jpg">
<meta property="og:image" content="http://7xux50.com2.z0.glb.clouddn.com/20161219148215164663809.jpg?imageView2/0/format/jpg">
<meta property="og:image" content="http://7xux50.com2.z0.glb.clouddn.com/20161219148215188029737.jpg?imageView2/0/format/jpg">
<meta property="og:image" content="http://7xux50.com2.z0.glb.clouddn.com/20161219148215223889945.jpg?imageView2/0/format/jpg">
<meta property="og:image" content="http://7xux50.com2.z0.glb.clouddn.com/20161220148220156666279.jpg?imageView2/0/format/jpg">
<meta property="og:image" content="http://7xux50.com2.z0.glb.clouddn.com/20161220148221767315005.jpg?imageView2/0/format/jpg">
<meta property="og:image" content="http://7xux50.com2.z0.glb.clouddn.com/20161220148222791854140.jpg?imageView2/0/format/jpg">
<meta property="og:updated_time" content="2016-12-21T02:42:51.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CoreText 入门">
<meta name="twitter:description" content="CoreText认识 Core Text is an advanced, low-level technology for laying out text and handling fonts. The Core Text API, introduced in Mac OS X v10.5 and iOS 3.2, is accessible from all OS X and iOS envir">
<meta name="twitter:image" content="http://xiangwangfeng.com/images/ct6.jpg">

    
    <link rel="alternative" href="/atom.xml" title="严青的博客" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="严青的博客" title="严青的博客"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="严青的博客">严青的博客</a></h1>
				<h2 class="blog-motto">记录学习</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">主页</a></li>
					
						<li><a href="/archives">归档</a></li>
					
						<li><a href="/categories">分类</a></li>
					
						<li><a href="/tags">标签</a></li>
					
						<li><a href="/about">关于</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:lizhaojie001.github.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/10/09/CoreText-入门/" title="CoreText 入门" itemprop="url">CoreText 入门</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="严青" target="_blank" itemprop="author">严青</a>
		
  <p class="article-time">
    <time datetime="2016-10-09T08:31:54.000Z" itemprop="datePublished"> 发表于 2016-10-09</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#CoreText认识"><span class="toc-number">1.</span> <span class="toc-text">CoreText认识</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Core-Text知识准备"><span class="toc-number">2.</span> <span class="toc-text">Core Text知识准备</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Core-Text对象模型"><span class="toc-number">3.</span> <span class="toc-text">Core Text对象模型 </span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Laying-Out-a-Paragraph-段落布局"><span class="toc-number">4.</span> <span class="toc-text">Laying Out a Paragraph(段落布局)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Before"><span class="toc-number">4.1.</span> <span class="toc-text">Before</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Simple-Text-Label"><span class="toc-number">5.</span> <span class="toc-text">Simple Text Label</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#在这里我们来探讨一下OSX和iOS坐标系转换的关系"><span class="toc-number">5.1.</span> <span class="toc-text">在这里我们来探讨一下OSX和iOS坐标系转换的关系</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Columnar-Layout-列布局"><span class="toc-number">6.</span> <span class="toc-text">Columnar Layout(列布局)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Manual-Line-Breaking-截断布局"><span class="toc-number">7.</span> <span class="toc-text">Manual Line Breaking(截断布局)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Applying-a-Paragraph-Style-应用段落格式"><span class="toc-number">8.</span> <span class="toc-text">Applying a Paragraph Style(应用段落格式)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Displaying-Text-in-a-Nonrectangular-Region-非矩形区域展示"><span class="toc-number">9.</span> <span class="toc-text">Displaying Text in a Nonrectangular Region(非矩形区域展示)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#文章参考"><span class="toc-number">9.1.</span> <span class="toc-text">文章参考</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#官网"><span class="toc-number">9.2.</span> <span class="toc-text">官网</span></a></li></ol></li></ol>
		
		</div>
		
		<h1 id="CoreText认识"><a href="#CoreText认识" class="headerlink" title="CoreText认识"></a>CoreText认识</h1><blockquote>
<p>Core Text is an advanced, low-level technology for laying out text and handling fonts. The Core Text API, introduced in Mac OS X v10.5 and iOS 3.2, is accessible from all OS X and iOS environments.</p>
</blockquote>
<p><strong>Important</strong>: Core Text is intended for developers who must do text layout and font handling at a low level, such as developers of layout engines. You should develop your app using a higher-level framework if possible—that is, use Text Kit in iOS (see Text Programming Guide for iOS) or the Cocoa text system in OS X (see a target=”_self” Cocoa Text Architecture Guide\/a). Core Text is the technology underlying those text systems, so they share in its speed and efficiency. In addition, Text Kit and the Cocoa text system provide rich text editing, full-featured page layout engines, and other infrastructure that your app would otherwise need to provide if it used Core Text alone.</p>
<p><strong>CoreText</strong> 是用于处理文字和字体的底层技术。它直接和 Core Graphics（又被称为 Quartz）打交道。Quartz 是一个 2D 图形渲染引擎，能够处理 OSX 和 iOS 中的图形显示。</p>
<p>Quartz 能够直接处理字体（font）和字形（glyphs），将文字渲染到界面上，它是基础库中唯一能够处理字形的模块。因此，CoreText 为了排版，需要将显示的文本内容、位置、字体、字形直接传递给 Quartz。相比其它 UI 组件，由于 CoreText 直接和 Quartz 来交互，所以它具有高速的排版效果。</p>
<p><img src="http://xiangwangfeng.com/images/ct6.jpg" alt=""></p>
<p>下图是 CoreText 的架构图，可以看到，CoreText 处于非常底层的位置，上层的 UI 控件（包括 UILabel，UITextField 以及 UITextView）和 UIWebView 都是基于 CoreText 来实现的。</p>
<p><img src="http://tangqiao.b0.upaiyun.com/coretext/coretext_arch.png" alt=""></p>
<p> <strong>Tips:</strong></p>
<blockquote>
<p>在面向对象编程领域中，单一功能原则（Single responsibility principle）规定每个类都应该有一个单一的功能，并且该功能应该由这个类完全封装起来。所有它的（这个类的）服务都应该严密的和该功能平行（功能平行，意味着没有依赖）.</p>
</blockquote>
<h1 id="Core-Text知识准备"><a href="#Core-Text知识准备" class="headerlink" title="Core Text知识准备"></a>Core Text知识准备</h1><p> <strong>1.字符（Character）和字形（Glyphs）
</strong> </p>
<blockquote>
<p>排版系统中文本显示的一个重要的过程就是字符到字形的转换，字符是信息本身的元素，而字形是字符的图形表征，字符还会有其它表征比如发音。 字符在计算机中其实就是一个编码，某个字符集中的编码，比如Unicode字符集，就囊括了大都数存在的字符。 而字形则是图形，一般都存储在字体文件中，字形也有它的编码，也就是它在字体中的索引。 一个字符可以对应多个字形（不同的字体，或者同种字体的不同样式:粗体斜体等）；多个字符也可能对应一个字形，比如字符的连写（ Ligatures）。</p>
</blockquote>
<p><img src="http://ww1.sinaimg.cn/large/65cc0af7gw1e2u5ypr899g.gif" alt=""></p>
<p> Roman Ligatures</p>
<p>下面就来详情看看字形的各个参数也就是所谓的字形度量Glyph Metrics</p>
<p><img src="http://ww3.sinaimg.cn/large/65cc0af7jw1e2ucdlrkfbg.gif" alt=""></p>
<p><img src="http://ww2.sinaimg.cn/large/65cc0af7gw1e2u242uytyg.gif" alt=""><br><img src="http://7xux50.com2.z0.glb.clouddn.com/2016122114822846996545.jpg?imageView2/0/format/jpg" alt="2016122114822846996545.jpg"></p>
<p><strong>bounding box（边界框 bbox）</strong>，这是一个假想的框子，它尽可能紧密的装入字形。</p>
<p><strong>baseline（基线）</strong>，一条假想的线,一行上的字形都以此线作为上下位置的参考，在这条线的左侧存在一个点叫做基线的原点，</p>
<p><strong>ascent（上行高度</strong>）从原点到字体中最高（这里的高深都是以基线为参照线的）的字形的顶部的距离，ascent是一个正值</p>
<p><strong>descent（下行高度）</strong>从原点到字体中最深的字形底部的距离，descent是一个负值（比如一个字体原点到最深的字形的底部的距离为2，那么descent就为-2）</p>
<p><strong>linegap（行距</strong>），linegap也可以称作leading（其实准确点讲应该叫做External leading）,行高lineHeight则可以通过 ascent + descent + linegap 来计算。</p>
<p><strong> 2.坐标系 </strong></p>
<blockquote>
<p>首先不得不说 苹果编程中的坐标系花样百出，经常让开发者措手不及。 传统的Mac中的坐标系的原点在左下角，比如NSView默认的坐标系，原点就在左下角。但Mac中有些View为了其实现的便捷将原点变换到左上角，像NSTableView的坐标系坐标原点就在左上角。iOS UIKit的UIView的坐标系原点在左上角。  往底层看，Core Graphics的context使用的坐标系的原点是在左下角。而在iOS中的底层界面绘制就是通过Core Graphics进行的，那么坐标系列是如何变换的呢？ 在UIView的drawRect方法中我们可以通过UIGraphicsGetCurrentContext()来获得当前的Graphics Context。drawRect方法在被调用前，这个Graphics Context被创建和配置好，你只管使用便是。如果你细心，通过CGContextGetCTM(CGContextRef c)可以看到其返回的值并不是CGAffineTransformIdentity，通过打印出来看到值为</p>
</blockquote>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Printing description of contextCTM: (CGAffineTransform) <span class="attr">contextCTM</span> = &#123; <span class="attr">a</span> = <span class="number">1</span> <span class="attr">b</span> = <span class="number">0</span> <span class="attr">c</span> = <span class="number">0</span> <span class="attr">d</span> = -<span class="number">1</span> <span class="attr">tx</span> = <span class="number">0</span> <span class="attr">ty</span> = <span class="number">460</span> &#125;</span><br></pre></td></tr></table></figure>
<p>这是非retina分辨率下的结果，如果是如果是retina上面的a,d,ty的值将会乘2，如果是iPhone 5，ty的值会再大些。 但是作用都是一样的就是将上下文空间坐标系进行了flip，使得原本左下角原点变到左上角，y轴正方向也变换成向下。</p>
<p>上面说了一大堆，下面进入正题，Core Text一开始便是定位于桌面的排版系统，使用了传统的原点在左下角的坐标系，所以它在绘制文本的时候都是参照左下角的原点进行绘制的。 但是iOS的UIView的drawRect方法的context被做了次flip，如果你啥也不做处理，直接在这个context上进行Core Text绘制，你会发现文字是镜像且上下颠倒。</p>
<p><img src="http://ww4.sinaimg.cn/large/65cc0af7gw1e2uwkpr6rfj.jpg" alt=""></p>
<p>所以在UIView的drawRect方法中的context上进行Core Text绘制之前需要对context进行一次Flip。</p>
<p><img src="http://ww1.sinaimg.cn/large/65cc0af7gw1e2uwlh7zvej.jpg" alt=""></p>
<p>这里再提及一个函数CGContextSetTextMatrix，它可以用来为每一个显示的字形单独设置变形矩阵。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="selector-tag">CGContextSetTextMatrix</span>(<span class="selector-tag">context</span>, <span class="selector-tag">CGAffineTransformIdentity</span>); <span class="selector-tag">CGContextTranslateCTM</span>(<span class="selector-tag">context</span>, 0, <span class="selector-tag">self</span><span class="selector-class">.bounds</span><span class="selector-class">.size</span><span class="selector-class">.height</span>); <span class="selector-tag">CGContextScaleCTM</span>(<span class="selector-tag">context</span>, 1<span class="selector-class">.0</span>, <span class="selector-tag">-1</span><span class="selector-class">.0</span>);</span><br></pre></td></tr></table></figure>
<p><strong> 3.NSMutableAttributedString 和 CFMutableAttributedStringRef </strong></p>
<p>Core Foundation和Foundation中的有些数据类型只需要简单的强制类型转换就可以互换使用，这类类型我们叫他们为<a href="https://developer.apple.com/library/content/documentation/CoreFoundation/Conceptual/CFDesignConcepts/Articles/tollFreeBridgedTypes.html" target="_blank" rel="noopener">Toll-Free Bridged Types</a>。  CFMutableAttributedStringRef和NSMutableAttributedString就是其中的一对，Core Foundation的接口基本是C的接口，功能强大，但是使用起来没有Foundation中提供的Objc的接口简单好使，所以很多时候我们可以使用高层接口组织数据，然后将其传给低层函数接口使用。</p>
<h1 id="Core-Text对象模型"><a href="#Core-Text对象模型" class="headerlink" title="Core Text对象模型 "></a>Core Text对象模型 </h1><blockquote>
<p>这节主要来看看Core Text绘制的一些细节问题了</p>
</blockquote>
<p><strong>首先是Core Text绘制的流程：</strong><br><img src="http://ww1.sinaimg.cn/large/65cc0af7gw1e2uxd1gmhwj.jpg" alt=""></p>
<p><img src="http://ww4.sinaimg.cn/large/65cc0af7gw1e2uyn6r88oj.jpg" alt=""></p>
<ul>
<li><p><strong>framesetter</strong> framesetter对应的类型是 CTFramesetter，通过CFAttributedString进行初始化，它作为CTFrame对象的生产工厂，负责根据path生产对应的CTFrame</p>
</li>
<li><p><strong>CTFrame</strong> CTFrame是可以通过CTFrameDraw函数直接绘制到context上的，当然你可以在绘制之前，操作CTFrame中的CTLine，进行一些参数的微调</p>
</li>
<li><p><strong>CTLine</strong> 可以看做Core Text绘制中的一行的对象 通过它可以获得当前行的line ascent,line descent ,line leading,还可以获得Line下的所有Glyph Runs</p>
</li>
<li><p><strong>CTRun</strong> 或者叫做 Glyph Run，是一组共享想相同attributes（属性）的字形的集合体</p>
</li>
</ul>
<blockquote>
<p>上面说了这么多对也没一个东西和图片绘制有关系，其实吧，Core Text本身并不支持图片绘制，图片的绘制你还得通过Core Graphics来进行。只是Core Text可以通过CTRun的设置为你的图片在文本绘制的过程中留出适当的空间。这个设置就使用到CTRunDelegate了，看这个名字大概就可以知道什么意思了，CTRunDelegate作为CTRun相关属性或操作扩展的一个入口，使得我们可以对CTRun做一些自定义的行为。为图片留位置的方法就是加入一个空白的CTRun，自定义其ascent，descent，width等参数，使得绘制文本的时候留下空白位置给相应的图片。然后图片在相应的空白位置上使用Core Graphics接口进行绘制。  使用CTRunDelegateCreate可以创建一个CTRunDelegate，它接收两个参数，一个是callbacks结构体，一个是所有callback调用的时候需要传入的对象。 callbacks的结构体为CTRunDelegateCallbacks，主要是包含一些回调函数，比如有返回当前run的ascent，descent，width这些值的回调函数，至于函数中如何鉴别当前是哪个run，可以在CTRunDelegateCreate的第二个参数来达到目的，因为CTRunDelegateCreate的第二个参数会作为每一个回调调用时的入参。</p>
</blockquote>
<h1 id="Laying-Out-a-Paragraph-段落布局"><a href="#Laying-Out-a-Paragraph-段落布局" class="headerlink" title="Laying Out a Paragraph(段落布局)"></a>Laying Out a Paragraph(段落布局)</h1><h2 id="Before"><a href="#Before" class="headerlink" title="Before"></a><strong>Before</strong></h2><blockquote>
<p>To lay out the paragraph, you need a graphics context to draw into, a rectangular path to provide the area where the text is laid out, and an attributed string. Most of the code in this example is required to create and initialize the context, path, and string.</p>
</blockquote>
<p>This code could reside in the <code>drawRect</code>: method of a <code>UIView</code> subclass</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect &#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Initialize a graphics context in iOS.</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Flip the context coordinates, in iOS only.</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGContextTranslateCTM</span>(context, <span class="number">0</span>, <span class="keyword">self</span>.bounds.size.height);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGContextScaleCTM</span>(context, <span class="number">1.0</span>, <span class="number">-1.0</span>);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Initializing a graphic context in OS X is different:</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// CGContextRef context =</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//     (CGContextRef)[[NSGraphicsContext currentContext] graphicsPort];</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Set the text matrix.</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGContextSetTextMatrix</span>(context, <span class="built_in">CGAffineTransformIdentity</span>);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Create a path which bounds the area where you will be drawing text.</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// The path need not be rectangular.</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGMutablePathRef</span> path = <span class="built_in">CGPathCreateMutable</span>();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// In this simple example, initialize a rectangular path.</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGRect</span> bounds = <span class="built_in">CGRectMake</span>(<span class="number">10.0</span>, <span class="number">0.0</span>, <span class="number">100.0</span>, <span class="number">200.0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGPathAddRect</span>(path, <span class="literal">NULL</span>, bounds );</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Initialize a string.</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CFStringRef</span> textString = <span class="built_in">CFSTR</span>(<span class="string">"Hello, World! I know nothing in the world that has as much power as a word. Sometimes I write one, and I look at it, until it begins to shine."</span>);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Create a mutable attributed string with a max length of 0.</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// The max length is a hint as to how much internal storage to reserve.</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 0 means no hint.</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CFMutableAttributedStringRef</span> attrString =</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CFAttributedStringCreateMutable</span>(kCFAllocatorDefault, <span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Copy the textString into the newly created attrString</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CFAttributedStringReplaceString</span> (attrString, <span class="built_in">CFRangeMake</span>(<span class="number">0</span>, <span class="number">0</span>),</span><br><span class="line">                                     </span><br><span class="line">                                     textString);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Create a color that will be added as an attribute to the attrString.</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGColorSpaceRef</span> rgbColorSpace = <span class="built_in">CGColorSpaceCreateDeviceRGB</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGFloat</span> components[] = &#123; <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.8</span> &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGColorRef</span> red = <span class="built_in">CGColorCreate</span>(rgbColorSpace, components);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGColorSpaceRelease</span>(rgbColorSpace);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Set the color of the first 12 chars to red.</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CFAttributedStringSetAttribute</span>(attrString, <span class="built_in">CFRangeMake</span>(<span class="number">0</span>, <span class="number">12</span>),kCTForegroundColorAttributeName, red);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Create the framesetter with the attributed string.</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CTFramesetterRef</span> framesetter =</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CTFramesetterCreateWithAttributedString</span>(attrString);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CFRelease</span>(attrString);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Create a frame.</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  &lt;#Description#&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *  @param framesetter &lt;#framesetter description#&gt;</span></span><br><span class="line"><span class="comment">     *  @param 0           长度(从第几个开始显示)和宽度(显示字节数) (0,0)不限制显示</span></span><br><span class="line"><span class="comment">     *  @param 0           &lt;#0 description#&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *  @return &lt;#return value description#&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="built_in">CTFrameRef</span> frame = <span class="built_in">CTFramesetterCreateFrame</span>(framesetter,</span><br><span class="line">                                                </span><br><span class="line">                                                <span class="built_in">CFRangeMake</span>(<span class="number">0</span>, <span class="number">0</span>), path, <span class="literal">NULL</span>);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Draw the specified frame in the given context.</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CTFrameDraw</span>(frame, context);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Release the objects we used.</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CFRelease</span>(frame);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CFRelease</span>(path);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CFRelease</span>(framesetter);</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Simple-Text-Label"><a href="#Simple-Text-Label" class="headerlink" title="Simple Text Label"></a>Simple Text Label</h1><blockquote>
<p>简单的标签布局</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect &#123;</span><br><span class="line">    <span class="comment">// Drawing code</span></span><br><span class="line">    <span class="built_in">CFStringRef</span> string = <span class="built_in">CFSTR</span>(<span class="string">"Hello, World! I know nothing in the world that has as much power as a word. Sometimes I write one, and I look at it, until it begins to shine."</span>);</span><br><span class="line">    <span class="built_in">CFStringRef</span> fontName =<span class="built_in">CFSTR</span>(<span class="string">"Papyrus"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CTFontRef</span>  font =</span><br><span class="line">    <span class="built_in">CTFontCreateWithName</span>(fontName, <span class="number">15</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">   <span class="comment">// CGContextTranslateCTM(context, 0, self.bounds.size.height);</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// CGContextScaleCTM(context, 1.0, -1.0);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Initialize the string, font, and context</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CFStringRef</span> keys[] = &#123; kCTFontAttributeName &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CFTypeRef</span> values[] = &#123; font &#125;;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CFDictionaryRef</span> attributes =</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CFDictionaryCreate</span>(kCFAllocatorDefault,(<span class="keyword">const</span> <span class="keyword">void</span>**)&amp;keys,</span><br><span class="line">                       </span><br><span class="line">                     (<span class="keyword">const</span> <span class="keyword">void</span>**)&amp;values, <span class="keyword">sizeof</span>(keys) / <span class="keyword">sizeof</span>(keys[<span class="number">0</span>]),</span><br><span class="line">                       </span><br><span class="line">                       &amp;kCFTypeDictionaryKeyCallBacks,</span><br><span class="line"></span><br><span class="line">                       &amp;kCFTypeDictionaryValueCallBacks);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CFAttributedStringRef</span> attrString =</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CFAttributedStringCreate</span>(kCFAllocatorDefault, string, attributes);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CFRelease</span>(string);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CFRelease</span>(attributes);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CTLineRef</span> line = <span class="built_in">CTLineCreateWithAttributedString</span>(attrString);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Set text position and draw the line into the graphics context</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGContextSetTextPosition</span>(context, <span class="number">100</span>, <span class="number">10</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CTLineDraw</span>(line, context);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CFRelease</span>(line);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="在这里我们来探讨一下OSX和iOS坐标系转换的关系"><a href="#在这里我们来探讨一下OSX和iOS坐标系转换的关系" class="headerlink" title="在这里我们来探讨一下OSX和iOS坐标系转换的关系"></a>在这里我们来探讨一下OSX和iOS坐标系转换的关系</h2><blockquote>
<p>了解两个函数</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">CGContextTranslateCTM</span>(<span class="selector-tag">context</span>, 0, <span class="selector-tag">self</span><span class="selector-class">.bounds</span><span class="selector-class">.size</span><span class="selector-class">.height</span>); </span><br><span class="line"><span class="selector-tag">CGContextScaleCTM</span>(<span class="selector-tag">context</span>, 1<span class="selector-class">.0</span>, <span class="selector-tag">-1</span><span class="selector-class">.0</span>);</span><br></pre></td></tr></table></figure>
<p><strong>what’s meanning?</strong><br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="built_in">CGContextTranslateCTM</span> ( <span class="built_in">CGContextRef</span> c, <span class="built_in">CGFloat</span> tx, <span class="built_in">CGFloat</span> ty );</span><br></pre></td></tr></table></figure></p>
<p><strong>Parameters</strong></p>
<ul>
<li><code>c</code><br><em>A graphics context.</em></li>
<li><code>tx</code><br><em>The amount to displace the x-axis of the coordinate space, in units of the user space, of the specified context.</em></li>
<li><code>ty</code><br><em>The amount to displace the y-axis of the coordinate space, in units of the user space, of the specified context.</em><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="built_in">CGContextScaleCTM</span> ( <span class="built_in">CGContextRef</span> c, <span class="built_in">CGFloat</span> sx, <span class="built_in">CGFloat</span> sy )</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>Parameters</strong><br><code>c</code><br><em>A graphics context.</em><br><code>sx</code><br><em>The factor by which to scale the x-axis of the coordinate space of the specified context.</em><br><code>sy</code><br><em>The factor by which to scale the y-axis of the coordinate space of the specified context.</em></p>
<p>改变三个参数来看看效果</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CGContextTranslateCTM(<span class="name">context</span>, <span class="number">0</span>, self.bounds.size.height)<span class="comment">; </span></span><br><span class="line">CGContextScaleCTM(<span class="name">context</span>, <span class="number">1.0</span>, <span class="number">-1.0</span>)<span class="comment">;</span></span><br><span class="line">CGContextSetTextPosition(<span class="name">context</span>, <span class="number">100</span>, <span class="number">10</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p><strong>第一个改变<code>CGContextSetTextPosition(context, x, 10)</code>中x的值</strong></p>
<ul>
<li>x=10</li>
</ul>
<p><img src="http://7xux50.com2.z0.glb.clouddn.com/20161219148214987090595.jpg?imageView2/0/format/jpg" alt="20161219148214987090595.jpg"></p>
<hr>
<ul>
<li>x=100</li>
</ul>
<p><img src="http://7xux50.com2.z0.glb.clouddn.com/20161219148215001527630.jpg?imageView2/0/format/jpg" alt="20161219148215001527630.jpg"></p>
<hr>
<ul>
<li>x=-100</li>
</ul>
<p><img src="http://7xux50.com2.z0.glb.clouddn.com/2016121914821501244382.jpg?imageView2/0/format/jpg" alt="2016121914821501244382.jpg"></p>
<blockquote>
<p>x控制左右移动</p>
</blockquote>
<hr>
<ul>
<li>y=100</li>
</ul>
<p><img src="http://7xux50.com2.z0.glb.clouddn.com/20161219148215025125706.jpg?imageView2/0/format/jpg" alt="20161219148215025125706.jpg"></p>
<hr>
<ul>
<li>y=50</li>
</ul>
<p><img src="http://7xux50.com2.z0.glb.clouddn.com/20161219148215032912970.jpg?imageView2/0/format/jpg" alt="20161219148215032912970.jpg"></p>
<hr>
<ul>
<li>y=-10</li>
</ul>
<p><img src="http://7xux50.com2.z0.glb.clouddn.com/20161219148215040140848.jpg?imageView2/0/format/jpg" alt="20161219148215040140848.jpg"></p>
<blockquote>
<p>y控制竖直方向</p>
</blockquote>
<hr>
<p><strong>第二个改变<code>CGContextTranslateCTM(context, 0, y)</code>中y的值;</strong></p>
<ul>
<li>y=20</li>
</ul>
<p><img src="http://7xux50.com2.z0.glb.clouddn.com/20161219148215067551448.jpg?imageView2/0/format/jpg" alt="20161219148215067551448.jpg"></p>
<ul>
<li>y=100</li>
</ul>
<p><img src="http://7xux50.com2.z0.glb.clouddn.com/20161219148215075086710.jpg?imageView2/0/format/jpg" alt="20161219148215075086710.jpg"></p>
<ul>
<li>y =-50<br>空白</li>
</ul>
<blockquote>
<p>y控制上下移</p>
</blockquote>
<p><strong>第三个改变<code>CGContextTranslateCTM(context,x *1.0,y *1.0)</code>中x,y的值;</strong> </p>
<blockquote>
<p>x=1.0 y= -1.0</p>
</blockquote>
<p><img src="http://7xux50.com2.z0.glb.clouddn.com/2016121914821521365588.jpg?imageView2/0/format/jpg" alt="2016121914821521365588.jpg"></p>
<hr>
<blockquote>
<p>x=0.5 y =- 1.0</p>
</blockquote>
<p><img src="http://7xux50.com2.z0.glb.clouddn.com/2016121914821513271334.jpg?imageView2/0/format/jpg" alt="2016121914821513271334.jpg"></p>
<hr>
<blockquote>
<p>x=0.3 y =- 1.0</p>
</blockquote>
<p><img src="http://7xux50.com2.z0.glb.clouddn.com/20161219148215145682042.jpg?imageView2/0/format/jpg" alt="20161219148215145682042.jpg"></p>
<hr>
<blockquote>
<p>x =1.0 y =-0.5</p>
</blockquote>
<p><img src="http://7xux50.com2.z0.glb.clouddn.com/20161219148215164663809.jpg?imageView2/0/format/jpg" alt="20161219148215164663809.jpg"></p>
<hr>
<blockquote>
<p>x =1.0 y= -0.3</p>
</blockquote>
<p><img src="http://7xux50.com2.z0.glb.clouddn.com/20161219148215188029737.jpg?imageView2/0/format/jpg" alt="20161219148215188029737.jpg"></p>
<hr>
<blockquote>
<p>x =1.0 y= 0</p>
</blockquote>
<p><img src="http://7xux50.com2.z0.glb.clouddn.com/20161219148215223889945.jpg?imageView2/0/format/jpg" alt="20161219148215223889945.jpg"></p>
<hr>
<blockquote>
<p>x =1.0 y=1.0</p>
</blockquote>
<p><strong>空白</strong></p>
<hr>
<h1 id="Columnar-Layout-列布局"><a href="#Columnar-Layout-列布局" class="headerlink" title="Columnar Layout(列布局)"></a>Columnar Layout(列布局)</h1><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect &#123;</span><br><span class="line">    <span class="comment">// Drawing code</span></span><br><span class="line">    <span class="comment">// Initialize a graphics context in iOS.</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Flip the context coordinates in iOS only.</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGContextTranslateCTM</span>(context, <span class="number">0</span>, <span class="keyword">self</span>.bounds.size.height);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGContextScaleCTM</span>(context, <span class="number">1.0</span>, <span class="number">-1.0</span>);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Initializing a graphic context in OS X is different:</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// CGContextRef context =</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//     (CGContextRef)[[NSGraphicsContext currentContext] graphicsPort];</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Set the text matrix.</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGContextSetTextMatrix</span>(context, <span class="built_in">CGAffineTransformIdentity</span>);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Create the framesetter with the attributed string.</span></span><br><span class="line">    <span class="built_in">CFStringRef</span> fontName =<span class="built_in">CFSTR</span>(<span class="string">"Papyrus"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CTFontRef</span>  font =</span><br><span class="line">    <span class="built_in">CTFontCreateWithName</span>(fontName, <span class="number">15</span>, <span class="literal">NULL</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CFStringRef</span> keys[] = &#123; kCTFontAttributeName &#125;;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CFTypeRef</span> values[] = &#123; font &#125;;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CFDictionaryRef</span> attributes =</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CFDictionaryCreate</span>(kCFAllocatorDefault,(<span class="keyword">const</span> <span class="keyword">void</span>**)&amp;keys,</span><br><span class="line">                       </span><br><span class="line">                       (<span class="keyword">const</span> <span class="keyword">void</span>**)&amp;values, <span class="keyword">sizeof</span>(keys) / <span class="keyword">sizeof</span>(keys[<span class="number">0</span>]),</span><br><span class="line">                       </span><br><span class="line">                       &amp;kCFTypeDictionaryKeyCallBacks,</span><br><span class="line">                       </span><br><span class="line">                       &amp;kCFTypeDictionaryValueCallBacks);</span><br><span class="line">    </span><br><span class="line">       <span class="built_in">CFStringRef</span> string = <span class="built_in">CFSTR</span>(<span class="string">"Hello, World! I know nothing in the world that has as much power as a word. Sometimes I write one, and I look at it, until it begins to shine."</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CFAttributedStringRef</span> attrString =</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CFAttributedStringCreate</span>(kCFAllocatorDefault, string, attributes);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">CTFramesetterRef</span> framesetter = <span class="built_in">CTFramesetterCreateWithAttributedString</span>(attrString);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Call createColumnsWithColumnCount function to create an array of</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// three paths (columns).</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CFArrayRef</span> columnPaths = [<span class="keyword">self</span> createColumnsWithColumnCount:<span class="number">3</span>];</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CFIndex</span> pathCount = <span class="built_in">CFArrayGetCount</span>(columnPaths);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CFIndex</span> startIndex = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> column;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Create a frame for each column (path).</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (column = <span class="number">0</span>; column &lt; pathCount; column++) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Get the path for this column.</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">CGPathRef</span> path = (<span class="built_in">CGPathRef</span>)<span class="built_in">CFArrayGetValueAtIndex</span>(columnPaths, column);</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Create a frame for this column and draw it.</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">CTFrameRef</span> frame = <span class="built_in">CTFramesetterCreateFrame</span>(</span><br><span class="line">                                                    </span><br><span class="line">                                                    framesetter, <span class="built_in">CFRangeMake</span>(startIndex, <span class="number">0</span>), path, <span class="literal">NULL</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">CTFrameDraw</span>(frame, context);</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Start the next frame at the first character not visible in this frame.</span></span><br><span class="line">        </span><br><span class="line">        <span class="built_in">CFRange</span> frameRange = <span class="built_in">CTFrameGetVisibleStringRange</span>(frame);</span><br><span class="line">        </span><br><span class="line">        startIndex += frameRange.length;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">CFRelease</span>(frame);</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CFRelease</span>(columnPaths);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CFRelease</span>(framesetter);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//计算列数</span></span><br><span class="line">- (<span class="built_in">CFArrayRef</span>)createColumnsWithColumnCount:(<span class="keyword">int</span>)columnCount</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> column;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGRect</span>* columnRects = (<span class="built_in">CGRect</span>*)calloc(columnCount, <span class="keyword">sizeof</span>(*columnRects));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Set the first column to cover the entire view.</span></span><br><span class="line">    </span><br><span class="line">    columnRects[<span class="number">0</span>] = <span class="keyword">self</span>.bounds;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Divide the columns equally across the frame's width.</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGFloat</span> columnWidth = <span class="built_in">CGRectGetWidth</span>(<span class="keyword">self</span>.bounds) / columnCount;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (column = <span class="number">0</span>; column &lt; columnCount - <span class="number">1</span>; column++) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">CGRectDivide</span>(columnRects[column], &amp;columnRects[column],</span><br><span class="line">                     </span><br><span class="line">                     &amp;columnRects[column + <span class="number">1</span>], columnWidth, <span class="built_in">CGRectMinXEdge</span>);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Inset all columns by a few pixels of margin.</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (column = <span class="number">0</span>; column &lt; columnCount; column++) &#123;</span><br><span class="line">        </span><br><span class="line">        columnRects[column] = <span class="built_in">CGRectInset</span>(columnRects[column], <span class="number">8.0</span>, <span class="number">15.0</span>);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Create an array of layout paths, one for each column.</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CFMutableArrayRef</span> array =</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CFArrayCreateMutable</span>(kCFAllocatorDefault,</span><br><span class="line">                         </span><br><span class="line">                         columnCount, &amp;kCFTypeArrayCallBacks);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (column = <span class="number">0</span>; column &lt; columnCount; column++) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">CGMutablePathRef</span> path = <span class="built_in">CGPathCreateMutable</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">CGPathAddRect</span>(path, <span class="literal">NULL</span>, columnRects[column]);</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">CFArrayInsertValueAtIndex</span>(array, column, path);</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">CFRelease</span>(path);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    free(columnRects);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> array;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如图:</p>
<p><img src="http://7xux50.com2.z0.glb.clouddn.com/20161220148220156666279.jpg?imageView2/0/format/jpg" alt="20161220148220156666279.jpg"></p>
<h1 id="Manual-Line-Breaking-截断布局"><a href="#Manual-Line-Breaking-截断布局" class="headerlink" title="Manual Line Breaking(截断布局)"></a>Manual Line Breaking(截断布局)</h1><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect &#123;</span><br><span class="line">    <span class="comment">// Drawing code</span></span><br><span class="line">    <span class="keyword">double</span> width; <span class="built_in">CGContextRef</span> context; <span class="built_in">CGPoint</span> textPosition; <span class="built_in">CFAttributedStringRef</span> attrString;</span><br><span class="line">    <span class="comment">// Initialize those variables.</span></span><br><span class="line">     <span class="built_in">CFStringRef</span> string = <span class="built_in">CFSTR</span>(<span class="string">"Hello, World! I know nothing in the world that has as much power as a word. Sometimes I write one, and I look at it, until it begins to shine."</span>);</span><br><span class="line">    <span class="comment">//冲掉150字节后面的字符串</span></span><br><span class="line">    width = <span class="number">150.0</span>;</span><br><span class="line">    context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGContextTranslateCTM</span>(context, <span class="number">0</span>, <span class="keyword">self</span>.frame.size.height);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGContextScaleCTM</span>(context, <span class="number">1.0</span>, <span class="number">-1.0</span>);</span><br><span class="line">    </span><br><span class="line">   <span class="comment">//起始位置</span></span><br><span class="line">    textPosition = <span class="built_in">CGPointMake</span>(<span class="number">10.0</span>, <span class="number">50.0</span>);</span><br><span class="line">    <span class="comment">//字形</span></span><br><span class="line">    <span class="built_in">CFStringRef</span> fontName =<span class="built_in">CFSTR</span>(<span class="comment">/*"Papyrus"*/</span><span class="string">"HanziPenSC-W3"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CTFontRef</span>  font =</span><br><span class="line">    <span class="built_in">CTFontCreateWithName</span>(fontName, <span class="number">15</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="comment">//笔调重描痕迹</span></span><br><span class="line">    <span class="built_in">CGFloat</span> number = <span class="number">3.0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CFNumberRef</span> strokeWidth = <span class="built_in">CFNumberCreate</span>(kCFAllocatorDefault, kCFNumberCGFloatType, &amp;number  );</span><br><span class="line">    <span class="comment">//笔调颜色重描痕迹</span></span><br><span class="line">    <span class="built_in">CGColorSpaceRef</span> space =   <span class="built_in">CGColorSpaceCreateDeviceRGB</span>();</span><br><span class="line">    <span class="built_in">CGFloat</span> components[] = &#123;<span class="number">1.0</span>,<span class="number">0.0</span>,<span class="number">0.0</span>,<span class="number">0.8</span>&#125;;</span><br><span class="line">    <span class="built_in">CGColorRef</span> color = <span class="built_in">CGColorCreate</span>(space, components);</span><br><span class="line">    <span class="comment">// Controls vertical text positioning</span></span><br><span class="line">    <span class="built_in">CGFloat</span> superScriptnumber = <span class="number">-1.0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CFNumberRef</span> superScript = <span class="built_in">CFNumberCreate</span>(kCFAllocatorDefault, kCFNumberCGFloatType, &amp;superScriptnumber  );</span><br><span class="line">    <span class="comment">//kCTUnderlineStyleAttributeName</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *    kCTUnderlineStyleNone           = 0x00,</span></span><br><span class="line"><span class="comment">     kCTUnderlineStyleSingle         = 0x01,</span></span><br><span class="line"><span class="comment">     kCTUnderlineStyleThick          = 0x02,</span></span><br><span class="line"><span class="comment">     kCTUnderlineStyleDouble         = 0x09</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="built_in">CGFloat</span> UnderlineStylenumber =kCTUnderlinePatternDash| kCTUnderlineStyleDouble;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CFNumberRef</span> UnderlineStyle = <span class="built_in">CFNumberCreate</span>(kCFAllocatorDefault, kCFNumberCGFloatType, &amp;UnderlineStylenumber  );</span><br><span class="line">    <span class="comment">//kCTUnderlineColorAttributeName</span></span><br><span class="line">    <span class="built_in">CGColorSpaceRef</span> Underlinespace =   <span class="built_in">CGColorSpaceCreateDeviceRGB</span>();</span><br><span class="line">    <span class="built_in">CGFloat</span> Underlinecomponents[] = &#123;<span class="number">0.0</span>,<span class="number">0.5</span>,<span class="number">0.5</span>,<span class="number">1</span>&#125;;</span><br><span class="line">    <span class="built_in">CGColorRef</span> Underlinecolor = <span class="built_in">CGColorCreate</span>(Underlinespace, Underlinecomponents);</span><br><span class="line">    <span class="comment">//kCTVerticalFormsAttributeName 文字方向</span></span><br><span class="line">    <span class="built_in">CFBooleanRef</span> t = kCFBooleanFalse;</span><br><span class="line">    </span><br><span class="line"> <span class="comment">/*   //kCTGlyphInfoAttributeName  字形信息</span></span><br><span class="line"><span class="comment">    CFStringRef glyphName = CFSTR("lessequal");</span></span><br><span class="line"><span class="comment">    CFStringRef baseString = CFSTR("Hello");</span></span><br><span class="line"><span class="comment">    CFStringRef GlyphInfofontName =CFSTR("HanziPenSC-W3");</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    CTFontRef  GlyphInfofont =</span></span><br><span class="line"><span class="comment">    CTFontCreateWithName(GlyphInfofontName, 30, NULL);</span></span><br><span class="line"><span class="comment">    CTGlyphInfoRef info = CTGlyphInfoCreateWithGlyphName(glyphName, GlyphInfofont, string);</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">    <span class="built_in">CFStringRef</span> keys[] = &#123; kCTFontAttributeName,kCTStrokeWidthAttributeName ,kCTStrokeColorAttributeName,kCTSuperscriptAttributeName,kCTUnderlineColorAttributeName,kCTUnderlineStyleAttributeName,kCTVerticalFormsAttributeName<span class="comment">/*,kCTGlyphInfoAttributeName*/</span> &#125;;</span><br><span class="line">   </span><br><span class="line">    <span class="built_in">CFTypeRef</span> values[] = &#123; font ,strokeWidth,color,superScript,Underlinecolor, UnderlineStyle  ,t<span class="comment">/*,info*/</span>&#125;;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CFDictionaryRef</span> attributes =</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CFDictionaryCreate</span>(kCFAllocatorDefault,(<span class="keyword">const</span> <span class="keyword">void</span>**)&amp;keys,</span><br><span class="line">                       </span><br><span class="line">                       (<span class="keyword">const</span> <span class="keyword">void</span>**)&amp;values,<span class="keyword">sizeof</span>(keys)/<span class="keyword">sizeof</span>(keys[<span class="number">0</span>]) ,</span><br><span class="line">                       </span><br><span class="line">                       &amp;kCFTypeDictionaryKeyCallBacks,</span><br><span class="line">                       </span><br><span class="line">                       &amp;kCFTypeDictionaryValueCallBacks);</span><br><span class="line">    </span><br><span class="line">   </span><br><span class="line">    </span><br><span class="line">      attrString =   <span class="built_in">CFAttributedStringCreate</span>(kCFAllocatorDefault, string, attributes);</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// Create a typesetter using the attributed string.</span></span><br><span class="line">    <span class="built_in">CTTypesetterRef</span> typesetter = <span class="built_in">CTTypesetterCreateWithAttributedString</span>(attrString);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Find a break for line from the beginning of the string to the given width.</span></span><br><span class="line">    <span class="built_in">CFIndex</span> start = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">CFIndex</span> count = <span class="built_in">CTTypesetterSuggestLineBreak</span>(typesetter, start, width);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Use the returned character count (to the break) to create the line.</span></span><br><span class="line">    <span class="built_in">CTLineRef</span> line = <span class="built_in">CTTypesetterCreateLine</span>(typesetter, <span class="built_in">CFRangeMake</span>(start, count));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Get the offset needed to center the line.</span></span><br><span class="line">    <span class="keyword">float</span> flush = <span class="number">0.5</span>; <span class="comment">// centered</span></span><br><span class="line">    <span class="keyword">double</span> penOffset = <span class="built_in">CTLineGetPenOffsetForFlush</span>(line, flush, width);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Move the given text drawing position by the calculated offset and draw the line.</span></span><br><span class="line">    <span class="built_in">CGContextSetTextPosition</span>(context, textPosition.x + penOffset, textPosition.y);</span><br><span class="line">    <span class="built_in">CTLineDraw</span>(line, context);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Move the index beyond the line break.</span></span><br><span class="line">    start += count;</span><br><span class="line">        <span class="built_in">CGColorRelease</span>(color);</span><br><span class="line">    <span class="built_in">CGColorRelease</span>(Underlinecolor);</span><br><span class="line">    <span class="built_in">CGColorSpaceRelease</span>(Underlinespace);</span><br><span class="line">      <span class="built_in">CGColorSpaceRelease</span>(space);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果图<br><img src="http://7xux50.com2.z0.glb.clouddn.com/20161220148221767315005.jpg?imageView2/0/format/jpg" alt="20161220148221767315005.jpg"></p>
<h1 id="Applying-a-Paragraph-Style-应用段落格式"><a href="#Applying-a-Paragraph-Style-应用段落格式" class="headerlink" title="Applying a Paragraph Style(应用段落格式)"></a>Applying a Paragraph Style(应用段落格式)</h1><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">NSAttributedString* applyParaStyle(</span><br><span class="line">                CFStringRef fontName , CGFloat pointSize,</span><br><span class="line">                NSString *plainText, CGFloat lineSpaceInc)&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Create the font so we can determine its height.</span></span><br><span class="line">    CTFontRef font = CTFontCreateWithName(fontName, pointSize, <span class="literal">NULL</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Set the lineSpacing.</span></span><br><span class="line">    CGFloat lineSpacing = (CTFontGetLeading(font) + lineSpaceInc) * <span class="number">2</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Create the paragraph style settings.</span></span><br><span class="line">    CTParagraphStyleSetting setting;</span><br><span class="line"> </span><br><span class="line">    setting.spec = kCTParagraphStyleSpecifierLineSpacing;</span><br><span class="line">    setting.valueSize = sizeof(CGFloat);</span><br><span class="line">    setting.value = <span class="meta">&amp;lineSpacing;</span></span><br><span class="line"> </span><br><span class="line">    CTParagraphStyleRef paragraphStyle = CTParagraphStyleCreate(<span class="meta">&amp;setting, 1);</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Add the paragraph style to the dictionary.</span></span><br><span class="line">    NSDictionary *attributes = [NSDictionary dictionaryWithObjectsAndKeys:</span><br><span class="line">                               (__bridge id)font, (id)kCTFontNameAttribute,</span><br><span class="line">                               (__bridge id)paragraphStyle,</span><br><span class="line">                               (id)kCTParagraphStyleAttributeName, nil];</span><br><span class="line">    CFRelease(font);</span><br><span class="line">    CFRelease(paragraphStyle);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Apply the paragraph style to the string to created the attributed string.</span></span><br><span class="line">    NSAttributedString* attrString = [[NSAttributedString alloc]</span><br><span class="line">                               initWithString:(NSString*)plainText</span><br><span class="line">                               attributes:attributes];</span><br><span class="line"> </span><br><span class="line">    return attrString;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//In Listing 2-7, the styled string is used to create a framesetter. The code uses the framesetter to create a frame and draws the frame.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Listing 2-7  Drawing the styled paragraph</span></span><br><span class="line">- (void)drawRect:(CGRect)rect &#123;</span><br><span class="line">    <span class="comment">// Initialize a graphics context in iOS.</span></span><br><span class="line">    CGContextRef context = UIGraphicsGetCurrentContext();</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Flip the context coordinates in iOS only.</span></span><br><span class="line">    CGContextTranslateCTM(context, <span class="number">0</span>, self.bounds.size.height);</span><br><span class="line">    CGContextScaleCTM(context, <span class="number">1.0</span>, -<span class="number">1.0</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Set the text matrix.</span></span><br><span class="line">    CGContextSetTextMatrix(context, CGAffineTransformIdentity);</span><br><span class="line"> </span><br><span class="line">    CFStringRef fontName = CFSTR(<span class="string">"Didot Italic"</span>);</span><br><span class="line">    CGFloat pointSize = <span class="number">24.0</span>;</span><br><span class="line"> </span><br><span class="line">    CFStringRef string = CFSTR(<span class="string">"Hello, World! I know nothing in the world that has</span></span><br><span class="line">                                   as much power as a word. Sometimes I write one,</span><br><span class="line">                                   and I look at it, until it begins to shine.<span class="string">");</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Apply the paragraph style.</span></span><br><span class="line">    NSAttributedString* attrString = applyParaStyle(fontName, pointSize, string, <span class="number">50.0</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Put the attributed string with applied paragraph style into a framesetter.</span></span><br><span class="line">    CTFramesetterRef framesetter =</span><br><span class="line">             CTFramesetterCreateWithAttributedString((CFAttributedStringRef)attrString);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Create a path to fill the View.</span></span><br><span class="line">    CGPathRef path = CGPathCreateWithRect(rect, <span class="literal">NULL</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Create a frame in which to draw.</span></span><br><span class="line">    CTFrameRef frame = CTFramesetterCreateFrame(</span><br><span class="line">                                    framesetter, CFRangeMake(<span class="number">0</span>, <span class="number">0</span>), path, <span class="literal">NULL</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Draw the frame.</span></span><br><span class="line">    CTFrameDraw(frame, context);</span><br><span class="line">    CFRelease(frame);</span><br><span class="line">    CGPathRelease(path);</span><br><span class="line">    CFRelease(framesetter);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Displaying-Text-in-a-Nonrectangular-Region-非矩形区域展示"><a href="#Displaying-Text-in-a-Nonrectangular-Region-非矩形区域展示" class="headerlink" title="Displaying Text in a Nonrectangular Region(非矩形区域展示)"></a>Displaying Text in a Nonrectangular Region(非矩形区域展示)</h1><blockquote>
<p>在一个非矩形区域内展示文字最困难的部分就是描述路径.</p>
</blockquote>
<p><strong>效果图:</strong><br><img src="http://7xux50.com2.z0.glb.clouddn.com/20161220148222791854140.jpg?imageView2/0/format/jpg" alt="20161220148222791854140.jpg"></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a path in the shape of a donut.</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> AddSquashedDonutPath(<span class="built_in">CGMutablePathRef</span> path,</span><br><span class="line">                                 <span class="keyword">const</span> <span class="built_in">CGAffineTransform</span> *m, <span class="built_in">CGRect</span> rect)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CGFloat</span> width = <span class="built_in">CGRectGetWidth</span>(rect);</span><br><span class="line">    <span class="built_in">CGFloat</span> height = <span class="built_in">CGRectGetHeight</span>(rect);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGFloat</span> radiusH = width / <span class="number">3.0</span>;</span><br><span class="line">    <span class="built_in">CGFloat</span> radiusV = height / <span class="number">3.0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGPathMoveToPoint</span>( path, m, rect.origin.x, rect.origin.y + height - radiusV);</span><br><span class="line">    <span class="built_in">CGPathAddQuadCurveToPoint</span>( path, m, rect.origin.x, rect.origin.y + height,</span><br><span class="line">                              rect.origin.x + radiusH, rect.origin.y + height);</span><br><span class="line">    <span class="built_in">CGPathAddLineToPoint</span>( path, m, rect.origin.x + width - radiusH,</span><br><span class="line">                         rect.origin.y + height);</span><br><span class="line">    <span class="built_in">CGPathAddQuadCurveToPoint</span>( path, m, rect.origin.x + width,</span><br><span class="line">                              rect.origin.y + height,</span><br><span class="line">                              rect.origin.x + width,</span><br><span class="line">                              rect.origin.y + height - radiusV);</span><br><span class="line">    <span class="built_in">CGPathAddLineToPoint</span>( path, m, rect.origin.x + width,</span><br><span class="line">                         rect.origin.y + radiusV);</span><br><span class="line">    <span class="built_in">CGPathAddQuadCurveToPoint</span>( path, m, rect.origin.x + width, rect.origin.y,</span><br><span class="line">                              rect.origin.x + width - radiusH, rect.origin.y);</span><br><span class="line">    <span class="built_in">CGPathAddLineToPoint</span>( path, m, rect.origin.x + radiusH, rect.origin.y);</span><br><span class="line">    <span class="built_in">CGPathAddQuadCurveToPoint</span>( path, m, rect.origin.x, rect.origin.y,</span><br><span class="line">                              rect.origin.x, rect.origin.y + radiusV);</span><br><span class="line">    <span class="built_in">CGPathCloseSubpath</span>( path);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGPathAddEllipseInRect</span>( path, m,</span><br><span class="line">                           <span class="built_in">CGRectMake</span>( rect.origin.x + width / <span class="number">2.0</span> - width / <span class="number">5.0</span>,</span><br><span class="line">                                      rect.origin.y + height / <span class="number">2.0</span> - height / <span class="number">5.0</span>,</span><br><span class="line">                                      width / <span class="number">5.0</span> * <span class="number">2.0</span>, height / <span class="number">5.0</span> * <span class="number">2.0</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Generate the path outside of the drawRect call so the path is calculated only once.</span></span><br><span class="line">- (<span class="built_in">NSArray</span> *)paths</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CGMutablePathRef</span> path = <span class="built_in">CGPathCreateMutable</span>();</span><br><span class="line">    <span class="built_in">CGRect</span> bounds = <span class="keyword">self</span>.bounds;</span><br><span class="line">    bounds = <span class="built_in">CGRectInset</span>(bounds, <span class="number">20.0</span>, <span class="number">10.0</span>);</span><br><span class="line">    AddSquashedDonutPath(path, <span class="literal">NULL</span>, bounds);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSMutableArray</span> *result =</span><br><span class="line">    [<span class="built_in">NSMutableArray</span> arrayWithObject:<span class="built_in">CFBridgingRelease</span>(path)];</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">super</span> drawRect:rect];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Initialize a graphics context in iOS.</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">UIGraphicsGetCurrentContext</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Flip the context coordinates in iOS only.</span></span><br><span class="line">    <span class="built_in">CGContextTranslateCTM</span>(context, <span class="number">0</span>, <span class="keyword">self</span>.bounds.size.height);</span><br><span class="line">    <span class="built_in">CGContextScaleCTM</span>(context, <span class="number">1.0</span>, <span class="number">-1.0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Set the text matrix.</span></span><br><span class="line">    <span class="built_in">CGContextSetTextMatrix</span>(context, <span class="built_in">CGAffineTransformIdentity</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Initialize an attributed string.</span></span><br><span class="line">    <span class="built_in">CFStringRef</span> textString = <span class="built_in">CFSTR</span>(<span class="string">"Hello, World! I know nothing in the world that has as much power as a word. Sometimes I write one, and I look at it, until it begins to shine.Hello, World! I know nothing in the world that has as much power as a word. Sometimes I write one, and I look at it, until it begins to shineHello, World! I know nothing in the world that has as much power as a word. Sometimes I write one, and I look at it, until it begins to shineHello, World! I know nothing in the world that has as much power as a word. Sometimes I write one, and I look at it, until it begins to shineHello, World! I know nothing in the world that has as much power as a word. Sometimes I write one, and I look at it, until it begins to shineHello, World! I know nothing in the world that has as much power as a word. Sometimes I write one, and I look at it, until it begins to shineHello, World! I know nothing in the world that has as much power as a word. Sometimes I write one, and I look at it, until it begins to shineHello, World! I know nothing in the world that has as much power as a word. Sometimes I write one, and I look at it, until it begins to shineHello, World! I know nothing in the world that has as much power as a word. Sometimes I write one, and I look at it, until it begins to shine"</span>);</span><br><span class="line">                                   </span><br><span class="line">                                   <span class="comment">// Create a mutable attributed string.</span></span><br><span class="line">                                   <span class="built_in">CFMutableAttributedStringRef</span> attrString =</span><br><span class="line">                                   <span class="built_in">CFAttributedStringCreateMutable</span>(kCFAllocatorDefault, <span class="number">0</span>);</span><br><span class="line">                                   </span><br><span class="line">                                   <span class="comment">// Copy the textString into the newly created attrString.</span></span><br><span class="line">                                   <span class="built_in">CFAttributedStringReplaceString</span> (attrString, <span class="built_in">CFRangeMake</span>(<span class="number">0</span>, <span class="number">0</span>), textString);</span><br><span class="line">                                   </span><br><span class="line">                                   <span class="comment">// Create a color that will be added as an attribute to the attrString.</span></span><br><span class="line">                                   <span class="built_in">CGColorSpaceRef</span> rgbColorSpace = <span class="built_in">CGColorSpaceCreateDeviceRGB</span>();</span><br><span class="line">                                   <span class="built_in">CGFloat</span> components[] = &#123; <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.8</span> &#125;;</span><br><span class="line">                                   <span class="built_in">CGColorRef</span> red = <span class="built_in">CGColorCreate</span>(rgbColorSpace, components);</span><br><span class="line">                                   <span class="built_in">CGColorSpaceRelease</span>(rgbColorSpace);</span><br><span class="line">                                   </span><br><span class="line">                                   <span class="comment">// Set the color of the first 13 chars to red.</span></span><br><span class="line">                                   <span class="built_in">CFAttributedStringSetAttribute</span>(attrString, <span class="built_in">CFRangeMake</span>(<span class="number">0</span>, <span class="number">13</span>),</span><br><span class="line">                                                                  kCTForegroundColorAttributeName, red);</span><br><span class="line">                                   </span><br><span class="line">                                   <span class="comment">// Create the framesetter with the attributed string.</span></span><br><span class="line">                                   <span class="built_in">CTFramesetterRef</span> framesetter = <span class="built_in">CTFramesetterCreateWithAttributedString</span>(attrString);</span><br><span class="line">                                   </span><br><span class="line">                                   <span class="comment">// Create the array of paths in which to draw the text.</span></span><br><span class="line">                                   <span class="built_in">NSArray</span> *paths = [<span class="keyword">self</span> paths];</span><br><span class="line">                                   </span><br><span class="line">                                   <span class="built_in">CFIndex</span> startIndex = <span class="number">0</span>;</span><br><span class="line">                                   </span><br><span class="line">                                   <span class="comment">// In OS X, use NSColor instead of UIColor.</span></span><br><span class="line"><span class="meta">#define GREEN_COLOR [UIColor greenColor]</span></span><br><span class="line"><span class="meta">#define YELLOW_COLOR [UIColor yellowColor]</span></span><br><span class="line"><span class="meta">#define BLACK_COLOR [UIColor blackColor]</span></span><br><span class="line">                                   </span><br><span class="line">                                   <span class="comment">// For each path in the array of paths...</span></span><br><span class="line">                                   <span class="keyword">for</span> (<span class="keyword">id</span> object <span class="keyword">in</span> paths) &#123;</span><br><span class="line">                                       <span class="built_in">CGPathRef</span> path = (__bridge <span class="built_in">CGPathRef</span>)object;</span><br><span class="line">                                       </span><br><span class="line">                                       <span class="comment">// Set the background of the path to yellow.</span></span><br><span class="line">                                       <span class="built_in">CGContextSetFillColorWithColor</span>(context, [YELLOW_COLOR <span class="built_in">CGColor</span>]);</span><br><span class="line">                                       </span><br><span class="line">                                       <span class="built_in">CGContextAddPath</span>(context, path);</span><br><span class="line">                                       <span class="built_in">CGContextFillPath</span>(context);</span><br><span class="line">                                       </span><br><span class="line">                                       <span class="built_in">CGContextDrawPath</span>(context, kCGPathStroke);</span><br><span class="line">                                       </span><br><span class="line">                                       <span class="comment">// Create a frame for this path and draw the text.</span></span><br><span class="line">                                       <span class="built_in">CTFrameRef</span> frame = <span class="built_in">CTFramesetterCreateFrame</span>(framesetter,</span><br><span class="line">                                                                                   <span class="built_in">CFRangeMake</span>(startIndex, <span class="number">0</span>), path, <span class="literal">NULL</span>);</span><br><span class="line">                                       <span class="built_in">CTFrameDraw</span>(frame, context);</span><br><span class="line">                                       </span><br><span class="line">                                       <span class="comment">// Start the next frame at the first character not visible in this frame.</span></span><br><span class="line">                                       <span class="built_in">CFRange</span> frameRange = <span class="built_in">CTFrameGetVisibleStringRange</span>(frame);</span><br><span class="line">                                       startIndex += frameRange.length;</span><br><span class="line">                                       <span class="built_in">CFRelease</span>(frame);</span><br><span class="line">                                   &#125;</span><br><span class="line">                                   </span><br><span class="line">                                   <span class="built_in">CFRelease</span>(attrString);</span><br><span class="line">                                   <span class="built_in">CFRelease</span>(framesetter);</span><br><span class="line">                                   &#125;</span><br></pre></td></tr></table></figure>
<p>随后就学习一下path的创建</p>
<h2 id="文章参考"><a href="#文章参考" class="headerlink" title="文章参考"></a>文章参考</h2><ul>
<li><a href="http://www.saitjr.com/ios/use-coretext-make-typesetting-picture-and-text.html" target="_blank" rel="noopener">http://www.saitjr.com/ios/use-coretext-make-typesetting-picture-and-text.html</a></li>
<li><p><a href="http://geeklu.com/2013/03/core-text/" target="_blank" rel="noopener">http://geeklu.com/2013/03/core-text/</a></p>
</li>
<li><p><a href="http://blog.devtang.com/2015/06/27/using-coretext-2/" target="_blank" rel="noopener">http://blog.devtang.com/2015/06/27/using-coretext-2/</a> (唐巧博客)</p>
</li>
</ul>
<h2 id="官网"><a href="#官网" class="headerlink" title="官网"></a><a href="https://developer.apple.com/reference/coretext?language=objc" target="_blank" rel="noopener">官网</a></h2><ul>
<li><a href="https://developer.apple.com/library/content/documentation/StringsTextFonts/Conceptual/CoreText_Programming/LayoutOperations/LayoutOperations.html#//apple_ref/doc/uid/TP40005533-CH12-SW11" target="_blank" rel="noopener">https://developer.apple.com/library/content/documentation/StringsTextFonts/Conceptual/CoreText_Programming/LayoutOperations/LayoutOperations.html#//apple_ref/doc/uid/TP40005533-CH12-SW11</a></li>
</ul>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/iOS/">iOS</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/CoreText-翻译/">CoreText,翻译</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="https://lizhaojie001.github.io/2016/10/09/CoreText-入门/" data-title="CoreText 入门 | 严青的博客" data-tsina="" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2016/10/10/书签集合/" title="书签集合">
  <strong>上一篇：</strong><br/>
  <span>
  书签集合</span>
</a>
</div>


<div class="next">
<a href="/2016/10/08/App-Thinnin(app 瘦身)g/"  title="App Thinning (App 瘦身)">
 <strong>下一篇：</strong><br/> 
 <span>App Thinning (App 瘦身)
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="2016/10/09/CoreText-入门/" data-title="CoreText 入门" data-url="https://lizhaojie001.github.io/2016/10/09/CoreText-入门/"></div>
</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#CoreText认识"><span class="toc-number">1.</span> <span class="toc-text">CoreText认识</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Core-Text知识准备"><span class="toc-number">2.</span> <span class="toc-text">Core Text知识准备</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Core-Text对象模型"><span class="toc-number">3.</span> <span class="toc-text">Core Text对象模型 </span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Laying-Out-a-Paragraph-段落布局"><span class="toc-number">4.</span> <span class="toc-text">Laying Out a Paragraph(段落布局)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Before"><span class="toc-number">4.1.</span> <span class="toc-text">Before</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Simple-Text-Label"><span class="toc-number">5.</span> <span class="toc-text">Simple Text Label</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#在这里我们来探讨一下OSX和iOS坐标系转换的关系"><span class="toc-number">5.1.</span> <span class="toc-text">在这里我们来探讨一下OSX和iOS坐标系转换的关系</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Columnar-Layout-列布局"><span class="toc-number">6.</span> <span class="toc-text">Columnar Layout(列布局)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Manual-Line-Breaking-截断布局"><span class="toc-number">7.</span> <span class="toc-text">Manual Line Breaking(截断布局)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Applying-a-Paragraph-Style-应用段落格式"><span class="toc-number">8.</span> <span class="toc-text">Applying a Paragraph Style(应用段落格式)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Displaying-Text-in-a-Nonrectangular-Region-非矩形区域展示"><span class="toc-number">9.</span> <span class="toc-text">Displaying Text in a Nonrectangular Region(非矩形区域展示)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#文章参考"><span class="toc-number">9.1.</span> <span class="toc-text">文章参考</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#官网"><span class="toc-number">9.2.</span> <span class="toc-text">官网</span></a></li></ol></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/UI/" title="UI">UI<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/iOS/" title="iOS">iOS<sup>12</sup></a></li>
		  
		
		  
			<li><a href="/categories/前端技术/" title="前端技术">前端技术<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/技术/" title="技术">技术<sup>10</sup></a></li>
		  
		
		  
			<li><a href="/categories/正则/" title="正则">正则<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/网络/" title="网络">网络<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/翻译/" title="翻译">翻译<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/读书/" title="读书">读书<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/资料整理/" title="资料整理">资料整理<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/软件/" title="软件">软件<sup>1</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/iOS/" title="iOS">iOS<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/核心动画/" title="核心动画">核心动画<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/JavaScript/" title="JavaScript">JavaScript<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/AFNetworking/" title="AFNetworking">AFNetworking<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/ASDK/" title="ASDK">ASDK<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Git使用/" title="Git使用">Git使用<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Git/" title="Git">Git<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/CoreText-翻译/" title="CoreText,翻译">CoreText,翻译<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/搭建blog/" title="搭建blog">搭建blog<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/博客搭建/" title="博客搭建">博客搭建<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/书签集合/" title="书签集合">书签集合<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/通知/" title="通知">通知<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/技术/" title="技术">技术<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/CoreData/" title="CoreData">CoreData<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/ing/" title="ing">ing<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/插件/" title="插件">插件<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/字体-UI/" title="字体,UI">字体,UI<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/网络状态/" title="网络状态">网络状态<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/翻译-UIKit-Core-Graphics/" title="翻译,UIKit,Core Graphics">翻译,UIKit,Core Graphics<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/navigationBar/" title="navigationBar">navigationBar<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="https://onevcat.com/" target="_blank" title="喵神">喵神</a>
            
          </li>
        
          <li>
            
            	<a href="http://blog.devtang.com/" target="_blank" title="唐巧">唐巧</a>
            
          </li>
        
          <li>
            
            	<a href="http://southpeak.github.io/" target="_blank" title="南峰子">南峰子</a>
            
          </li>
        
    </ul>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	
	<div class="social-font" class="clearfix">
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2018 
		
		<a href="/about" target="_blank" title="严青">严青</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"abclzj"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?15eb05846c27f89873bbc51f5751758a";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
